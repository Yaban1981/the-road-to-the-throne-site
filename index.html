<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QHC — The Road to The Throne</title>
  <meta name="description" content="Intérêt tournois printemps 2026 — Boston, Montreal Meltdown, The Throne" />
  <meta name="referrer" content="origin">
  <link rel="canonical" href="https://yaban1981.github.io/the-road-to-the-throne-site/">

  <!-- Réseaux sociaux -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yaban1981.github.io/the-road-to-the-throne-site/">
  <meta property="og:title" content="QHC — The Road to The Throne">
  <meta property="og:description" content="Tournois printemps 2026 • Boston • Montreal Meltdown • The Throne">
  <meta property="og:image" content="https://yaban1981.github.io/the-road-to-the-throne-site/images/og-image.jpg?v=1">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="QHC — The Road to The Throne">
  <meta name="twitter:description" content="Intérêt tournois printemps 2026">
  <meta name="twitter:image" content="https://yaban1981.github.io/the-road-to-the-throne-site/images/og-image.jpg?v=1">

  <!-- Icônes -->
  <link rel="icon" href="https://yaban1981.github.io/the-road-to-the-throne-site/logos/qhc.png" sizes="32x32">
  <link rel="apple-touch-icon" href="https://yaban1981.github.io/the-road-to-the-throne-site/logos/qhc.png">
  <meta name="theme-color" content="#0a1020">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">

  <style>
    :root{
      --panel:#0e152a; --panel2:#0a1020; --text:#e7ecf3; --muted:#a7b3c7;
      --accent:#d4af37; --accent2:#3b82f6; --ring:rgba(59,130,246,.3); --radius:16px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{scroll-behavior:smooth; -webkit-text-size-adjust:100%}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background: radial-gradient(800px 400px at 10% -10%, #0b2451 0%, transparent 60%), linear-gradient(180deg, #091024, #0a0f1a);
      color:var(--text); line-height:1.5;
    }

    .hero{padding:28px 16px 18px; background:linear-gradient(180deg,#0a1020,#0b1222 60%,#0a0f1a); border-bottom:1px solid rgba(255,255,255,.06)}
    .hero-wrap{max-width:980px;margin:0 auto;display:flex;flex-direction:column;align-items:center;gap:18px}
    .hero-logo{width:120px;height:120px;border-radius:22px;display:grid;place-items:center;overflow:hidden;box-shadow:0 16px 44px rgba(3,102,214,.35)}
    .hero-logo img{width:100%;height:100%;object-fit:cover;border-radius:20px}
    .hero-text{text-align:center}
    .hero h1{margin:0;font-size:2rem;line-height:1.15}
    .hero-sub{margin:6px 0 4px;color:#dfe7ff;font-size:1.1rem}
    .hero-meta{margin:0;color:#9fb7ff;font-size:.95rem}

    .tournaments-section{max-width:1040px;margin:0 auto 20px;padding:0 16px}
    .tournaments{display:grid;grid-template-columns:1fr;gap:16px}
    .tcard{position:relative;background:#0b1020;border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:20px;min-height:180px;display:grid;place-items:center}
    .t-info-pill{position:absolute;bottom:12px;height:32px;display:flex;align-items:center;padding:6px 12px;border-radius:10px;font-size:.85rem;backdrop-filter:blur(6px)}
    .t-date{left:12px;color:#dfe7ff;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10)}
    .t-badge{right:12px;font-weight:800;color:#fff;background:linear-gradient(135deg,#1f7cff,#60a5fa)}

    main{padding:12px 16px 40px; max-width:1040px; margin:0 auto}
    .card, form{background:linear-gradient(180deg,var(--panel2),var(--panel)); border-radius:var(--radius); border:1px solid rgba(255,255,255,.06); padding:20px; margin:12px 0}
    fieldset{border:2px solid rgba(212,175,94,.35); padding:18px; border-radius:14px; margin:16px 0 0; position:relative}
    fieldset.completed::after{content:"✓"; position:absolute; top:-12px; right:15px; width:24px; height:24px; border-radius:50%; background:var(--accent); color:#0a0f1a; display:flex; align-items:center; justify-content:center; font-weight:800}
    legend{padding:0 8px; color:var(--accent2); font-weight:700; font-size:1.1rem; margin-bottom:8px}

    .grid{display:flex; flex-direction:column; gap:16px}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .input-container{position:relative}
    .input-container.valid::after{content:"✓"; position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--accent); font-weight:800}
    input[type="text"],input[type="email"],input[type="tel"],input[type="range"],select,textarea{
      width:100%; padding:14px 16px; border-radius:12px; border:1.5px solid rgba(255,255,255,.16);
      background:#0b1020; color:var(--text); outline:none; font-size:16px;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--accent2); box-shadow:0 0 0 3px var(--ring)}
    .check-row{display:flex;flex-direction:column;gap:10px}
    .check{position:relative;display:flex;align-items:center;gap:10px;padding:14px 44px 14px 48px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#0b1020}
    .check input{position:absolute;inset:0;opacity:0}
    .check::before{content:"";position:absolute;left:14px;top:50%;transform:translateY(-50%);width:18px;height:18px;border-radius:50%;border:2px solid #cfd8e3}
    .check:has(input:checked)::before{background:var(--accent2);border-color:#fff}

    .submit{margin-top:24px;display:flex;gap:12px;flex-direction:column}
    button{appearance:none;border:0;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;padding:16px 22px;border-radius:14px;font-weight:700;cursor:pointer}
    .outline{background:transparent;border:1px solid rgba(255,255,255,.12)}
    .confidence-display{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .confidence-value{font-weight:700;font-size:1.1rem;color:#3b82f6;background:rgba(59,130,246,.1);padding:4px 12px;border-radius:20px;border:1px solid rgba(59,130,246,.3)}

    @media (min-width:768px){
      .tournaments{grid-template-columns:repeat(3,1fr)}
      .submit{flex-direction:row}
      .grid{display:grid;gap:16px;grid-template-columns:repeat(12,1fr)}
      .col-12{grid-column:span 12} .col-6{grid-column:span 6} .col-4{grid-column:span 4} .col-3{grid-column:span 3}
    }
  </style>
</head>
<body>
  <noscript>
    <div style="background:#3b82f6;color:#fff;padding:10px;text-align:center">
      JavaScript requis pour validations et compteurs. / JavaScript required for validation & countdown.
    </div>
  </noscript>

  <header class="hero">
    <div class="hero-wrap">
      <div class="hero-logo">
        <img src="https://yaban1981.github.io/the-road-to-the-throne-site/logos/qhc.png" alt="Logo Québec HC" width="120" height="120">
      </div>
      <div class="hero-text">
        <h1>The Road to The Throne</h1>
        <p class="hero-sub">Intérêt tournois printemps 2026 / Spring 2026 interest</p>
        <p class="hero-meta">Confiance requise ≥ 80% • Confidence required ≥ 80%</p>
      </div>
    </div>
  </header>

  <!-- Tournois -->
  <div class="tournaments-section">
    <h2 style="text-align:center">Nos Tournois 2026 / Our 2026 Tournaments</h2>
    <div class="tournaments">
      <div class="tcard">
        <a class="logo" href="https://200x85.com/event/ccm-blue-chip-invite/" target="_blank" rel="noopener">
          <img src="https://yaban1981.github.io/the-road-to-the-throne-site/logos/bluechip.png" alt="CCM Blue Chip Invite" loading="lazy">
        </a>
        <div class="t-info-pill t-date">15–17.05.2026</div>
        <div class="t-info-pill t-badge" id="cd-boston">J-—</div>
      </div>
      <div class="tcard">
        <a class="logo" href="https://200x85.com/tournaments/montreal-meltdown/" target="_blank" rel="noopener">
          <img src="https://yaban1981.github.io/the-road-to-the-throne-site/logos/meltdown.png" alt="Montreal Meltdown" loading="lazy">
        </a>
        <div class="t-info-pill t-date">05–07.06.2026</div>
        <div class="t-info-pill t-badge" id="cd-meltdown">J-—</div>
      </div>
      <div class="tcard">
        <a class="logo" href="https://phdbestofbest.com/the-throne/" target="_blank" rel="noopener">
          <img src="https://yaban1981.github.io/the-road-to-the-throne-site/logos/throne.png" alt="The Throne" loading="lazy">
        </a>
        <div class="t-info-pill t-date">24–26.07.2026</div>
        <div class="t-info-pill t-badge" id="cd-throne">J-—</div>
      </div>
    </div>
  </div>

  <main>
    <div class="card">
      <h3>FR — Important</h3>
      <p>Ce formulaire sert à former les <strong>alignements par tournoi</strong>.</p>
      <p><strong>Règle The Throne</strong> : participation à au moins <strong>un</strong> autre tournoi (Boston ou Meltdown).</p>
      <p><strong>Places limitées</strong> : notre staff formera les <strong>meilleurs trios/duos</strong>.</p>
      <p class="small">Frais d’assurances et décharges à prévoir.</p>
      <hr style="opacity:.15;margin:14px 0">
      <h3>EN — Key info</h3>
      <p>This form builds <strong>tournament lineups</strong>.</p>
      <p><strong>Throne rule</strong>: must play in at least <strong>one</strong> other tournament.</p>
      <p><strong>Limited spots</strong>: staff will build the <strong>best lines/pairs</strong>.</p>
      <p class="small">Insurance fees & waivers required.</p>
    </div>

    <!-- En cas de JS OFF, FormSubmit fera la redirection grâce à _next -->
    <form action="https://formsubmit.co/yannick.banaszak@outlook.com" method="POST" id="qhc-form" novalidate>
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_template" value="table">
      <input type="hidden" name="_subject" value="QHC — The Road to The Throne — New submission / Nouvelle soumission">
      <input type="hidden" name="_bcc" value="David.belanger.6@ulaval.ca"><!-- retirer lors des tests si besoin -->
      <input type="hidden" name="form_version" value="rttt_v1_bilingual">
      <input type="hidden" name="_next" value="https://yaban1981.github.io/the-road-to-the-throne-site/thanks.html">
      <!-- Délivrabilité -->
      <input type="hidden" name="_replyto" id="replyto">
      <input type="hidden" name="email"    id="emaildup">

      <!-- 1) Joueur / Player -->
      <fieldset id="fieldset-player">
        <legend>1) Info joueur / Player Info</legend>
        <div class="grid">
          <div class="col-6 input-container">
            <label for="player_name">Nom complet / Full name <span class="req">*</span></label>
            <input id="player_name" name="player_name" type="text" required autocomplete="name">
          </div>
          <div class="col-3 input-container">
            <label for="birth_year">Année / Year <span class="req">*</span></label>
            <select id="birth_year" name="birth_year" required>
              <option value="">— Choisir / Select —</option>
              <option>2012</option><option>2013</option><option>2014</option><option>2015</option>
            </select>
          </div>
          <div class="col-3 input-container">
            <label for="city">Ville / City <span class="req">*</span></label>
            <input id="city" name="city" type="text" required>
          </div>
          <div class="col-6 input-container">
            <label for="current_team">Équipe actuelle / Current team</label>
            <input id="current_team" name="current_team" type="text">
          </div>
          <div class="col-6 input-container">
            <label for="parent_email">Courriel parent / Parent email <span class="req">*</span></label>
            <input id="parent_email" name="parent_email" type="email" required autocomplete="email" inputmode="email">
          </div>
          <div class="col-6 input-container">
            <label for="parent_phone">Téléphone parent / Parent phone</label>
            <input id="parent_phone" name="parent_phone" type="tel" autocomplete="tel">
          </div>
        </div>
      </fieldset>

      <!-- 2) Poste & style / Position & style -->
      <fieldset id="fieldset-position">
        <legend>2) Poste & style / Position & Style</legend>
        <div class="grid">
          <div class="col-6">
            <label>Position principale / Primary position <span class="req">*</span></label>
            <div class="check-row" role="radiogroup" aria-label="Primary position">
              <label class="check"><input type="radio" name="primary_position" value="Forward" required> Avant / Forward</label>
              <label class="check"><input type="radio" name="primary_position" value="Defence" required> Défense / Defence</label>
              <label class="check"><input type="radio" name="primary_position" value="Center" required> Centre / Center</label>
              <label class="check"><input type="radio" name="primary_position" value="Goaler" required> Gardien / Goaler</label>
            </div>
          </div>
          <div class="col-6">
            <label>Position secondaire / Secondary position</label>
            <div class="check-row" role="radiogroup" aria-label="Secondary position">
              <label class="check"><input type="radio" name="secondary_position" value="Forward"> Avant / Forward</label>
              <label class="check"><input type="radio" name="secondary_position" value="Defence"> Défense / Defence</label>
              <label class="check"><input type="radio" name="secondary_position" value="Center"> Centre / Center</label>
              <label class="check"><input type="radio" name="secondary_position" value="Goaler"> Gardien / Goaler</label>
              <label class="check"><input type="radio" name="secondary_position" value="None" checked> Aucune / None</label>
            </div>
          </div>

          <div class="col-12">
            <label>Côté / Side <span class="req">*</span></label>
            <div class="check-row" aria-label="Side (L/R)">
              <label class="check"><input type="checkbox" name="side_right" value="Yes"> Droite / Right</label>
              <label class="check"><input type="checkbox" name="side_left"  value="Yes"> Gauche / Left</label>
            </div>
          </div>

          <div class="col-12 input-container">
            <label for="player_style">Style de joueur / Player style</label>
            <input id="player_style" name="player_style" type="text" placeholder="ex: rapide/fast, offensif/offensive, physique/physical…">
          </div>
          <div class="col-12 input-container">
            <label for="video_links">Liens vidéo / Video links</label>
            <textarea id="video_links" name="video_links" placeholder="Collez vos liens/notes (multi‑lignes)… / Paste your links/notes (multi‑line)…"></textarea>
          </div>
        </div>
      </fieldset>

      <!-- 3) Chandail / Jersey -->
      <fieldset id="fieldset-jersey">
        <legend>3) Chandail / Jersey</legend>
        <div class="grid">
          <div class="col-4 input-container">
            <label for="jersey_number_1">Choix #1</label>
            <input id="jersey_number_1" name="jersey_number_1" type="text" inputmode="numeric" pattern="[0-9]{1,2}" placeholder="ex: 27">
          </div>
          <div class="col-4 input-container">
            <label for="jersey_number_2">Choix #2</label>
            <input id="jersey_number_2" name="jersey_number_2" type="text" inputmode="numeric" pattern="[0-9]{1,2}" placeholder="ex: 88">
          </div>
          <div class="col-4 input-container">
            <label for="jersey_number_3">Choix #3</label>
            <input id="jersey_number_3" name="jersey_number_3" type="text" inputmode="numeric" pattern="[0-9]{1,2}" placeholder="ex: 13">
          </div>
          <div class="col-6">
            <label>Type</label>
            <div class="check-row" role="radiogroup" aria-label="Jersey type">
              <label class="check"><input type="radio" name="jersey_type" value="Loaned" checked> Prêté / Loaned</label>
              <label class="check"><input type="radio" name="jersey_type" value="Customized"> Personnalisé / Custom</label>
            </div>
            <div class="muted" style="margin-top:8px">
              <strong>Note / Note:</strong> frais <u>supplémentaires</u> pour un chandail <strong>personnalisé</strong> (nom & numéro). / <em>Additional fee applies</em> for a <strong>custom jersey</strong> (name & number).
            </div>
          </div>
          <div class="col-6 input-container">
            <label for="jersey_size">Taille / Size <span class="req">*</span></label>
            <select id="jersey_size" name="jersey_size" required>
              <option value="">— Choisir / Select —</option>
              <option>YS</option><option>YM</option><option>YL</option>
              <option>AS</option><option>AM</option><option>AL</option><option>AXL</option>
            </select>
          </div>
        </div>
      </fieldset>

      <!-- 4) Disponibilités / Availability -->
      <fieldset id="fieldset-availability">
        <legend>4) Disponibilités / Availability</legend>
        <div class="grid">
          <div class="col-12" style="color:#a7b3c7">Aucun paiement maintenant / No payment now.</div>

          <div class="col-12">
            <label class="muted">Boston, MA — <span class="price">≈ 150 $ CAD</span> • <span class="date">15–17.05.2026</span></label>
            <div class="check-row" role="radiogroup" aria-label="Boston">
              <label class="check"><input type="radio" name="boston_showdown" value="Yes"> Oui / Yes</label>
              <label class="check"><input type="radio" name="boston_showdown" value="No"> Non / No</label>
              <label class="check"><input type="radio" name="boston_showdown" value="TBD" checked> À confirmer / TBD</label>
            </div>
          </div>

          <div class="col-12">
            <label class="muted">Montréal, QC — <span class="price">≈ 150 $ CAD</span> • <span class="date">05–07.06.2026</span></label>
            <div class="check-row" role="radiogroup" aria-label="Meltdown">
              <label class="check"><input type="radio" name="montreal_meltdown" value="Yes"> Oui / Yes</label>
              <label class="check"><input type="radio" name="montreal_meltdown" value="No"> Non / No</label>
              <label class="check"><input type="radio" name="montreal_meltdown" value="TBD" checked> À confirmer / TBD</label>
            </div>
          </div>

          <div class="col-12">
            <label class="muted">Toronto, ON — <span class="price">≈ 250 $ CAD</span> • <span class="date">24–26.07.2026</span></label>
            <div class="check-row" role="radiogroup" aria-label="The Throne">
              <label class="check"><input type="radio" name="the_throne" value="Yes"> Oui / Yes</label>
              <label class="check"><input type="radio" name="the_throne" value="No"> Non / No</label>
              <label class="check"><input type="radio" name="the_throne" value="TBD" checked> À confirmer / TBD</label>
            </div>
          </div>

          <div class="col-12">
            <label for="confidence_pct">Confiance / Confidence (≥ 80%)</label>
            <div class="slider-container" id="confidenceSlider">
              <input type="range" id="confidence_pct" name="confidence_pct" min="80" max="100" value="80"
                     aria-label="Confidence percent" aria-valuemin="80" aria-valuemax="100" aria-valuenow="80"
                     oninput="updateConfidenceValue(this.value)">
              <div class="hand-hint" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.5 9.5V7.5c0-1.1-.9-2-2-2s-2 .9-2 2v2m8 0V7.5c0-1.1-.9-2-2-2s-2 .9-2 2v2m8 0V7.5c0-1.1-.9-2-2-2s-2 .9-2 2v2M6.5 9.5v1c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2v-1m-8 3v2a2 2 0 0 0 4 0v-2"/>
                </svg>
              </div>
            </div>
            <div class="confidence-display">
              <span class="muted">Valeur / Value:</span>
              <span class="confidence-value" id="confVal">80%</span>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- 5) Confirmations -->
      <fieldset id="fieldset-confirmations">
        <legend>5) Confirmations</legend>
        <div class="grid">
          <div class="col-12 row small">
            <label class="check"><input type="checkbox" name="ack_throne_rule" required> Je comprends la règle The Throne / I understand the Throne rule <span class="req">*</span></label>
          </div>
          <div class="col-12 row small">
            <label class="check"><input type="checkbox" name="ack_limited_spots" required> Places limitées / Limited spots <span class="req">*</span></label>
          </div>
          <div class="col-12 row small">
            <label class="check"><input type="checkbox" name="consent_contact" required> J'accepte d'être contacté / I agree to be contacted <span class="req">*</span></label>
          </div>
        </div>
      </fieldset>

      <div class="submit">
        <button type="reset" class="outline">Effacer / Clear</button>
        <button type="submit">Soumettre / Submit</button>
      </div>
    </form>
  </main>

  <footer><div>© Québec HC — Spring 2026</div></footer>

  <script>
    // Compteurs "J-"
    (function(){
      const mk=(y,m,d)=>new Date(y,m-1,d,0,0,0,0);
      const targets=[{id:'cd-boston',date:mk(2026,5,15)},{id:'cd-meltdown',date:mk(2026,6,5)},{id:'cd-throne',date:mk(2026,7,24)}];
      function update(){
        const now=new Date(); const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());
        for(const t of targets){ const el=document.getElementById(t.id); if(!el) continue;
          const days=Math.ceil((t.date-today)/86400000);
          el.textContent=(days>0)?`J-${days}`:(days===0?'Jour J':'Terminé');
        }
      }
      update(); setInterval(update, 3600_000);
    })();

    function updateConfidenceValue(val){
      document.getElementById('confVal').textContent=val+'%';
      document.getElementById('confidence_pct').setAttribute('aria-valuenow', val);
    }

    function setupVisualValidation(){
      const form=document.getElementById('qhc-form');

      // Visuel champs
      form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea, select').forEach(el=>{
        el.addEventListener('input', ()=>{
          const wrap=el.closest('.input-container');
          if(wrap){
            const filled=(el.tagName==='SELECT')?el.value!=='' : el.value.trim()!=='';
            wrap.classList.toggle('valid', filled);
            el.classList.toggle('valid', filled);
          }
          markFieldset(el.closest('fieldset'));
        });
      });

      // Radios & cases
      form.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(el=>{
        el.addEventListener('change', ()=>{ markFieldset(el.closest('fieldset')); });
      });

      // Prime l'état visuel
      form.querySelectorAll('input,select,textarea').forEach(el=>{
        if(el.type==='range') return;
        const evt=(el.type==='radio'||el.type==='checkbox')?'change':'input';
        el.dispatchEvent(new Event(evt));
      });

      function markFieldset(fs){
        if(!fs) return; let ok=false;
        switch(fs.id){
          case 'fieldset-player': {
            const need=['player_name','birth_year','city','parent_email'];
            ok=need.every(id=>{
              const el=document.getElementById(id);
              return el && (el.tagName==='SELECT'? el.value!=='' : el.value.trim()!=='') && (el.id!=='parent_email' || el.checkValidity());
            }); break;
          }
          case 'fieldset-position': {
            const primary=!!fs.querySelector('input[name="primary_position"]:checked');
            const sideOK=fs.querySelector('[name="side_right"]').checked || fs.querySelector('[name="side_left"]').checked;
            ok=primary && sideOK; break;
          }
          case 'fieldset-jersey': {
            const typeOK=!!fs.querySelector('input[name="jersey_type"]:checked');
            const sizeOK=(document.getElementById('jersey_size').value!=='');
            ok=typeOK && sizeOK; break;
          }
          case 'fieldset-availability': {
            const b=!!fs.querySelector('input[name="boston_showdown"]:checked');
            const m=!!fs.querySelector('input[name="montreal_meltdown"]:checked');
            const t=!!fs.querySelector('input[name="the_throne"]:checked');
            const conf=parseInt(document.getElementById('confidence_pct').value,10) >= 80;
            ok=b && m && t && conf; break;
          }
          case 'fieldset-confirmations': {
            const c1=fs.querySelector('[name="ack_throne_rule"]').checked;
            const c2=fs.querySelector('[name="ack_limited_spots"]').checked;
            const c3=fs.querySelector('[name="consent_contact"]').checked;
            ok=c1 && c2 && c3; break;
          }
        }
        fs.classList.toggle('completed', ok);
      }
    }

    // Soumission AJAX + fallback bilingue + redirection absolue
    (function(){
      const form    = document.getElementById('qhc-form');
      const POST_TO = 'https://formsubmit.co/ajax/yannick.banaszak@outlook.com';
      const THANKS  = 'https://yaban1981.github.io/the-road-to-the-throne-site/thanks.html';
      setupVisualValidation();

      function toObj(f){ return Object.fromEntries(new FormData(f).entries()); }
      function emailBodyFR_EN(obj){
        const fr = ['QHC — The Road to The Throne — Soumission (secours)','--- FR ---'];
        const en = ['--- EN ---'];
        for(const [k,v] of Object.entries(obj)){ if(!k.startsWith('_')){ fr.push(`${k}: ${v}`); en.push(`${k}: ${v}`); } }
        return [...fr, ...en].join('\n');
      }

      async function sendAjax(fd){
        const ctrl=new AbortController(); const timer=setTimeout(()=>ctrl.abort(),12000);
        const res=await fetch(POST_TO,{method:'POST',headers:{'Accept':'application/json'},body:fd,signal:ctrl.signal});
        clearTimeout(timer);
        if(!res.ok) throw new Error('HTTP '+res.status);
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault();

        // HTML5
        if(!form.checkValidity()){
          const firstInvalid=form.querySelector(':invalid');
          if(firstInvalid){ firstInvalid.scrollIntoView({behavior:'smooth', block:'center'}); }
          return;
        }

        // Règles métier
        const right=form.querySelector('[name="side_right"]').checked;
        const left =form.querySelector('[name="side_left"]').checked;
        if(!right && !left){ alert('Sélectionnez au moins un côté (Droit/Gauche). / Select at least one side (Right/Left).'); return; }

        const throne=form.querySelector('[name="the_throne"]:checked')?.value || 'TBD';
        const boston=form.querySelector('[name="boston_showdown"]:checked')?.value || 'TBD';
        const meltdown=form.querySelector('[name="montreal_meltdown"]:checked')?.value || 'TBD';
        if(throne==='Yes' && !(boston==='Yes' || meltdown==='Yes')){
          alert("Règle The Throne : cochez 'Oui' à Boston OU Meltdown. / The Throne rule: tick 'Yes' for Boston OR Meltdown."); return;
        }

        const conf=parseInt(document.getElementById('confidence_pct').value,10);
        if(isNaN(conf)||conf<80){ alert('Confiance ≥ 80% / Confidence ≥ 80%.'); return; }

        // Délivrabilité: alimente _replyto + email avec le courriel parent
        const parentEmail=(document.getElementById('parent_email').value||'').trim();
        document.getElementById('replyto').value = parentEmail;
        document.getElementById('emaildup').value = parentEmail;

        // UI
        const btn=form.querySelector('button[type="submit"]');
        btn.disabled=true; btn.innerText='Envoi… / Submitting…';

        try{
          const fd=new FormData(form);
          fd.delete('_next'); // on redirige nous-mêmes
          await sendAjax(fd);
          window.location.assign(THANKS);
        }catch(err){
          console.error('FormSubmit indisponible:', err);
          const payload=toObj(form);
          const body=emailBodyFR_EN(payload);

          // Sauvegarde locale + presse-papiers
          try{
            const blob=new Blob([body],{type:'text/plain;charset=utf-8'});
            const a=document.createElement('a');
            a.href=URL.createObjectURL(blob);
            a.download=`qhc-form-backup-${Date.now()}.txt`;
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
            await navigator.clipboard.writeText(body);
          }catch(_){}

          // Ouvre un e‑mail de secours
          const subject='QHC — The Road to The Throne — Soumission / Submission (fallback)';
          const mailto=`mailto:yannick.banaszak@outlook.com?bcc=${encodeURIComponent('David.belanger.6@ulaval.ca')}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
          const link=document.createElement('a'); link.href=mailto; link.target='_blank'; link.rel='noopener'; link.style.display='none';
          document.body.appendChild(link); link.click(); link.remove();

          alert("Le service de formulaire est momentanément indisponible.\n"
              +"Un e‑mail prérempli s’est ouvert : cliquez sur « Envoyer ».\n"
              +"Vous allez être redirigé vers la page de remerciement.\n\n"
              +"The form service is temporarily unavailable.\n"
              +"A pre‑filled email has opened: please click “Send”.\n"
              +"You will now be redirected to the thank‑you page.");

          window.location.assign(THANKS);
          btn.disabled=false; btn.innerText='Soumettre / Submit';
        }
      });
    })();
  </script>
</body>
</html>
